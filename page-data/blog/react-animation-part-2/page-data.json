{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/react-animation-part-2/","result":{"data":{"blogPost":{"id":"3016723a-9b1d-5deb-b7be-5170bd32b44d","html":"<p>In <a href=\"/blog/react-animation-part-1\">Part 1</a>, we looked at CSS animation techniques, and how to use them in a CSS-in-JS React world. But we identified a few limitations of this approach, which leads us to need some JavaScript tools in our armoury. The limitations were:</p>\n<ul>\n<li>Animations coordinated between elements</li>\n<li>Realistic motion (ish)</li>\n<li>Animations driven by numeric/continuous values, rather than discrete values</li>\n</ul>\n<h3>Coordinating animation between elements</h3>\n<p>We can sequence animations between different elements with CSS transitions using delays (i.e. delay the animation of one element until the first element's animation is complete). However, this can get unwieldy if we're doing a lot of this (lots of elements, lots of animation, staggering/chaining animations).</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> Container <span class=\"token operator\">=</span> styled<span class=\"token punctuation\">.</span>div<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  display: flex;\n  height: 50px;\n  width: 500px;\n  position: relative;\n  justify-content: flex-end;\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> Dot <span class=\"token operator\">=</span> styled<span class=\"token punctuation\">.</span>div<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  position: absolute;\n  width: 10px;\n  height: 10px;\n  border-radius: 50%;\n  background-color: palevioletred;\n  left: 0;\n  top: 20px;\n  z-index: 10;\n  transition: transform 300ms;\n  </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token parameter\">props</span> <span class=\"token operator\">=></span>\n    props<span class=\"token punctuation\">.</span>activate <span class=\"token operator\">&amp;&amp;</span>\n    css<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n      transform: translateX(470px);\n    </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">;\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> pulse <span class=\"token operator\">=</span> keyframes<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n0% {\n  transform: scale(1);\n}\n50% {\n  transform: scale(1.5);\n}\n100% {\n  transform: scale(1);\n}\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> Target <span class=\"token operator\">=</span> styled<span class=\"token punctuation\">.</span>div<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  border-radius: 50%;\n  height: 50px;\n  width: 50px;\n  background-color: papayawhip;\n  </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token parameter\">props</span> <span class=\"token operator\">=></span>\n    props<span class=\"token punctuation\">.</span>activate <span class=\"token operator\">&amp;&amp;</span>\n    css<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n      animation: 200ms </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>pulse<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">;\n      animation-delay: 300ms;\n    </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">;\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">DotToTarget</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> activate <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>Container<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Dot activate<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>activate<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Target activate<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>activate<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Container<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><a href=\"https://codesandbox.io/s/cold-wood-jg3ui?file=/src/App.js:124-1069\">CodeSandbox</a></p>\n<p>Here we have a dot which moves to a target, which pulses when it gets there. But it feels quite imperative, rather than being React-y. We only want the Target to animate when it moves, rather than initially if we're already activated. React transition group has something which could help with this, but it's getting even more complicated.</p>\n<p>This sequencing also depends on the animations having fixed (or at least known calculated) durations, which brings the next point.</p>\n<h3>Realistic motion</h3>\n<p>Motion in the real world adheres more to spring-based physics rather than duration, so spring-based animations <em>feel</em> more natural to users. The duration of a spring-based animation is hard to calculate.</p>\n<p>The CSS timing functions can allow us relatively close to spring-based physics for some animations. Sometimes, a bezier curve can be a pretty good approximation (e.g. in <a href=\"https://medium.com/@alexandereardon/grabbing-the-flame-290c794fe852\">react-beautiful-dnd</a>). Or you can use keyframes to <a href=\"https://www.npmjs.com/package/css-spring\">simulate a spring</a>. I've tried these and they do work, but they still give imperfect static approximations - at some point, you're still assigning the animation a duration, which will either be constant or you'll need to calculate, which may be non-trivial (e.g. duration of a \"snap back\" animation based on drop point).</p>\n<p>In JavaScript-land, we can do the actual maths behind a spring.</p>\n<h3>Numeric values</h3>\n<p>Imagine we're building a progress bar component, where we expect the progress updates to be \"blocky\", but we don't want to just jump directly from one value to another.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> Container <span class=\"token operator\">=</span> styled<span class=\"token punctuation\">.</span>div<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  height: 50px;\n  width: 500px;\n  padding: 2px;\n  border: 1px solid black;\n</span><span class=\"token template-punctuation string\">`</span></span>\n<span class=\"token keyword\">const</span> Bar <span class=\"token operator\">=</span> styled<span class=\"token punctuation\">.</span>div<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  transition: width 50ms;\n  height: 46px;\n  background-color: green;\n  width: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token parameter\">props</span> <span class=\"token operator\">=></span> props<span class=\"token punctuation\">.</span>progress <span class=\"token operator\">*</span> <span class=\"token number\">500</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px;\n</span><span class=\"token template-punctuation string\">`</span></span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">ProgressBar</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span>progress<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">&lt;</span>Container<span class=\"token operator\">></span>\n   <span class=\"token operator\">&lt;</span>Bar progress<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>progress<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Container<span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p><em>I've used prop interpolation with a number here, which isn't great (new class for every value!). The same could equally be achieved with a width calculated as a style.</em></p>\n<p>That'll work, but there's a few issues with it:</p>\n<ul>\n<li>\n<p>The transition duration is constant, whether we've jumped 2% or 50%</p>\n<ul>\n<li>We could help this by calculating a new duration using the previous progress value, but that's a bit fiddly.</li>\n</ul>\n</li>\n<li>\n<p>We're animating <code class=\"language-text\">width</code>, which wasn't one of the <a href=\"https://www.html5rocks.com/en/tutorials/speed/high-performance-animations/\">good animation properties</a></p>\n<ul>\n<li>We can work around this by making the progress bar have width 1px, and then animate scaling it in the x direction only, and setting the transform origin to the left edge.</li>\n</ul>\n</li>\n<li>\n<p>We have to do a new render every time the progress changes. If the changes are less blocky, this is a lot of JavaScript work for React to do the reconciliation.</p>\n<ul>\n<li>If the progress was actually linked to our scroll position, for instance, we'd be killing scroll performance, which is a big no no.</li>\n</ul>\n</li>\n</ul>\n<p>So we can do something in CSS, but JavaScript-land looks appealing.</p>\n<h2>React Spring</h2>\n<p><a href=\"https://www.react-spring.io/\">React Spring</a> is my favourite React animation library. It has a simple but powerful API, which does bear some similarity to the React Native Animated (and Reanimated) library. Go to the link and see some of the stuff they've done!</p>\n<p>I find it particularly powerful when handling scroll-linked animations. Let's try to implement that progress bar component using it, using the companion <a href=\"https://github.com/react-spring/react-use-gesture\">react-use-gesture</a> library.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> Container <span class=\"token operator\">=</span> styled<span class=\"token punctuation\">.</span>div<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  height: 50px;\n  width: 500px;\n  padding: 2px;\n  border: 1px solid black;\n</span><span class=\"token template-punctuation string\">`</span></span>\n<span class=\"token keyword\">const</span> Bar <span class=\"token operator\">=</span> <span class=\"token function\">styled</span><span class=\"token punctuation\">(</span>animated<span class=\"token punctuation\">.</span>div<span class=\"token punctuation\">)</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  transition: width 50ms;\n  height: 46px;\n  background-color: green;\n</span><span class=\"token template-punctuation string\">`</span></span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">ProgressBar</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span>progress<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">&lt;</span>Container<span class=\"token operator\">></span>\n   <span class=\"token operator\">&lt;</span>Bar style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>width<span class=\"token operator\">:</span> progress<span class=\"token punctuation\">.</span><span class=\"token function\">interpolate</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">val</span> <span class=\"token operator\">=></span> val <span class=\"token operator\">*</span> <span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Container<span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">App</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>progress<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> setProgress<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useSpring</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>progress<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> bind <span class=\"token operator\">=</span> <span class=\"token function\">useScroll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span>xy<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setProgress</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>progress<span class=\"token operator\">:</span> xy<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">/</span> <span class=\"token constant\">HEIGHT</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>animated<span class=\"token punctuation\">.</span>main <span class=\"token punctuation\">{</span><span class=\"token operator\">...</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token constant\">SOME</span> <span class=\"token constant\">CONTENT</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>animated<span class=\"token punctuation\">.</span>main<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>ProgressBar progress<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>progress<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span><span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>That is a performant scroll listener! At first, it looks as though this is going to be triggering a new React renderfor every frame, when <code class=\"language-text\">progress</code> gets updated. But actually, <code class=\"language-text\">progress</code> is an object (an AnimatedValue), which <code class=\"language-text\">animated.div</code> knows how to interpret. It will update the style on the actual DOM element, bypassing the React render cycle. This is key to its performance - React is fast, but bypassing React when we can is even faster.</p>\n<p>Underneath, the DOM is being updated a lot of times in succession with an updated style tag. So we still want to make it easy for the browser to render this by sticking to the cheap animation properties where possible.</p>\n<p>React Spring also has an alternative primitive to React transition group for component mount/unmount animations, and special primitives to help us stagger/chain animations.</p>\n<p>Good for:</p>\n<ul>\n<li>Complex animations, particularly with multiple elements</li>\n<li>Scroll/Drag-triggered animations</li>\n</ul>\n<p>Less good for:</p>\n<ul>\n<li>Top performance (but still great!)</li>\n<li>Simple things, particularly where bundle size is critical (use CSS if that's all you need!)</li>\n</ul>\n<h2>Other tools</h2>\n<p>There are lots of great animation libraries for React (web/DOM), some of which are listed below. I don't have so much experience with these!</p>\n<ul>\n<li>\n<p><a href=\"https://www.framer.com/motion/\">Framer Motion</a></p>\n<ul>\n<li>Successor to Pose</li>\n</ul>\n</li>\n<li>\n<p><a href=\"https://github.com/chenglou/react-motion\">React Motion</a></p>\n<ul>\n<li>Inspired some of the React Spring API, but doesn't bypass the React render loop</li>\n</ul>\n</li>\n<li>\n<p><a href=\"https://github.com/joshwcomeau/react-flip-move\">React Flip Move</a> <a href=\"https://github.com/aholachek/react-flip-toolkit\">React Flip Toolkit</a></p>\n<ul>\n<li>React flip move is great for its specific purpose (list animations), React flip toolkit looks really powerful, might investigate for a shared element transition.</li>\n</ul>\n</li>\n<li>\n<p><a href=\"https://github.com/transitive-bullshit/react-particle-effect-button\">React Particle Effect Button</a></p>\n<ul>\n<li>Looks really cool. Might have to look into this... Doing some fun stuff with a Canvas.</li>\n</ul>\n</li>\n<li>\n<p><a href=\"https://github.com/TaitoUnited/react-sheltr\">React Sheltr</a></p>\n<ul>\n<li>I'm looking for an example of a shared element animation that I want to implement, this might be what I use to do it.</li>\n</ul>\n</li>\n</ul>\n<p>Obviously we <em>could</em> throw all of these in to do different animations in an application, but that would give us a huge bundle. So best to choose one (or maybe two) for a project and stick with it.</p>\n<p>The next few posts are going to include some examples of using these tools to achieve some animations from around the web and mobile apps. Until then, have a look at the <a href=\"/\">Projects page</a>.</p>\n<p>More links:</p>\n<ul>\n<li><a href=\"https://medium.com/@alexandereardon/dragging-react-performance-forward-688b30d40a33\">https://medium.com/@alexandereardon/dragging-react-performance-forward-688b30d40a33</a> has some interesting animation performance notes.</li>\n<li><a href=\"https://github.com/wcandillon/\">https://github.com/wcandillon/</a> kind of my hero when it comes to animation in React (focussed on React Native).</li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Transitions/Using_CSS_transitions\">MDN</a> has the best web developer docs. Don't use w3schools.</li>\n</ul>","frontmatter":{"title":"Animation in React - Tools - Part 2","date":"10 May 2020"},"fields":{"slug":"/blog/react-animation-part-2/"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/blog/react-animation-part-2/"}}}